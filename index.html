<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–•–æ—Ä–æ—à–∏–π, –ø–ª–æ—Ö–æ–π, –∑–ª–æ–π (1966)</title>

<style>
body{margin:0;font-family:'Arial Black',sans-serif;background:#1b0000;color:#eee;overflow-x:hidden;}
.wrapper{width:70%;margin:0 auto;padding-bottom:60px;}
.slider{position:relative;margin-top:20px;overflow:hidden;border-radius:10px;height:200px;background:#220000;padding:10px;box-shadow:0 0 15px #900;}
.slides{display:flex;transition:0.5s;}
.slides img{width:300px;margin-right:15px;border-radius:5px;cursor:pointer;transition:0.3s;}
.slides img:hover{transform:scale(1.05);}
.prev,.next{position:absolute;top:50%;transform:translateY(-50%);background:#330000;border:none;color:white;font-size:20px;padding:8px;cursor:pointer;border-radius:5px;}
.prev{left:5px;} .next{right:5px;}
.top{display:flex;gap:30px;margin-top:30px;}
.poster img{width:250px;border-radius:10px;box-shadow:0 0 20px #900;}
.info-block{display:flex;flex-direction:column;justify-content:flex-start;}
.description{margin-top:30px;line-height:1.6;padding:15px;background:#220000;border-radius:10px;box-shadow:0 0 15px #900;}
.video-container{margin-top:30px;}
.video-container iframe{width:100%;height:500px;border-radius:10px;box-shadow:0 0 25px #900;}
button{padding:6px 10px;background:#330000;color:white;border:1px solid #aa0000;border-radius:5px;cursor:pointer;margin-top:5px;font-size:12px;}
button:hover{background:#660000;}
.star{font-size:24px;color:#550000;cursor:pointer;}
.star.selected{color:gold;}
#avgRating{font-size:18px;color:gold;margin-top:10px;}
.comment{background:#140000;padding:10px;margin-top:10px;border-left:4px solid #aa0000;border-radius:5px;position:relative;}
.reply{margin-left:40px;background:#1f0000;border-left:4px solid #ff4444;}
.reply-level-2{margin-left:80px;background:#260000;border-left:4px solid #ffaa00;}
.comment-buttons{position:absolute;top:5px;right:5px;}
.comment-buttons button{margin-left:5px;padding:2px 5px;font-size:12px;}
</style>
</head>
<body>
<div class="wrapper">

<h2>–•–æ—Ä–æ—à–∏–π, –ø–ª–æ—Ö–æ–π, –∑–ª–æ–π (1966)</h2>

<div class="slider">
  <div class="slides" id="slides">
    <img src="https://upload.wikimedia.org/wikipedia/en/4/45/Good_the_bad_and_the_ugly_poster.jpg">
    <img src="https://m.media-amazon.com/images/I/91z+4nW6zRL._AC_SL1500_.jpg">
    <img src="https://upload.wikimedia.org/wikipedia/commons/2/22/The_Good_the_Bad_and_the_Ugly.jpg">
  </div>
  <button class="prev" onclick="moveSlide(-1)">‚ùÆ</button>
  <button class="next" onclick="moveSlide(1)">‚ùØ</button>
</div>

<div class="top">
  <div class="poster">
    <img src="https://i.imgur.com/XKxOxxg.jpg">
  </div>
  <div class="info-block">
    <p><b>–ü—Ä–æ—Å–º–æ—Ç—Ä—ã:</b> <span id="viewCount">0</span></p>
  </div>
</div>

<div class="description">–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä—ë—Ö –æ—Ö–æ—Ç–Ω–∏–∫–æ–≤ –∑–∞ —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–∞ –ì—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–π –≤–æ–π–Ω—ã –≤ –°–®–ê.</div>

<div class="video-container">
  <iframe src="https://www.youtube.com/embed/0Bwxz16-T04" allowfullscreen></iframe>
</div>

<h3>–í—Ö–æ–¥</h3>
<input type="text" id="loginName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
<button onclick="login()">–í–æ–π—Ç–∏</button>
<p id="currentUser"></p>

<h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
<input type="text" id="commentInput" placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π">
<button id="sendComment">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
<div id="commentList"></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>

const firebaseConfig = {
  apiKey: "AIzaSyCTr1vgcuSEn_2Ebh2vC3k7sNYzvMoYlBo",
  authDomain: "kino-project-bf21c.firebaseapp.com",
  projectId: "kino-project-bf21c",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let currentUser = localStorage.getItem("currentUser") || null;
function login(){
  const name = document.getElementById("loginName").value.trim();
  if(!name) return;
  currentUser = name;
  localStorage.setItem("currentUser", name);
  document.getElementById("currentUser").innerText = "–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: " + name;
}
if(currentUser){ document.getElementById("currentUser").innerText = "–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: " + currentUser; }

// –ø—Ä–æ—Å–º–æ—Ç—Ä—ã = 0
document.getElementById("viewCount").innerText = 0;

// –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
 document.getElementById("sendComment").addEventListener("click", async ()=>{
  if(!currentUser) return alert("–í–æ–π–¥–∏—Ç–µ!");
  const text = document.getElementById("commentInput").value.trim();
  if(!text) return;
  await db.collection("comments").add({
    name: currentUser,
    text: text,
    likes:0,
    dislikes:0,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
  document.getElementById("commentInput").value="";
});

// –ª–∞–π–∫ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π
async function addLike(ref){
  await db.runTransaction(async t=>{
    const doc = await t.get(ref);
    if(!doc.exists) return;
    t.update(ref,{likes:(doc.data().likes||0)+1});
  });
}
async function addDislike(ref){
  await db.runTransaction(async t=>{
    const doc = await t.get(ref);
    if(!doc.exists) return;
    t.update(ref,{dislikes:(doc.data().dislikes||0)+1});
  });
}

// –∑–∞–≥—Ä—É–∑–∫–∞
 db.collection("comments").orderBy("timestamp","desc").onSnapshot(snapshot=>{
  const container = document.getElementById("commentList");
  container.innerHTML="";

  snapshot.forEach(doc=>{
    renderComment(doc, container, 0);
  });
});

function renderComment(doc, parentEl, level){
  const data = doc.data();
  const div = document.createElement("div");
  div.className = "comment" + (level==1?" reply":"") + (level==2?" reply-level-2":"");
  div.id = doc.id;

  let buttonsHTML='';
  if(data.name===currentUser){
    buttonsHTML=`<div class="comment-buttons"><button onclick="deleteComment('${doc.ref.path}')">–£–¥–∞–ª–∏—Ç—å</button></div>`;
  } else {
    buttonsHTML=`<div class="comment-buttons"><button onclick="reply('${doc.ref.path}','${data.name}',${level})">–û—Ç–≤–µ—Ç–∏—Ç—å</button></div>`;
  }

  div.innerHTML=`<b>${data.name}</b>: ${data.text}<br>
    <button onclick="addLike(db.doc('${doc.ref.path}'))">üëç ${data.likes||0}</button>
    <button onclick="addDislike(db.doc('${doc.ref.path}'))">üëé ${data.dislikes||0}</button>
    ${buttonsHTML}
    <div class="children"></div>`;

  parentEl.appendChild(div);

  if(level < 2){
    doc.ref.collection("replies").orderBy("timestamp").onSnapshot(snap=>{
      const childrenDiv = div.querySelector(".children");
      childrenDiv.innerHTML="";
      snap.forEach(child=>{
        renderComment(child, childrenDiv, level+1);
      });
    });
  }
}

function reply(path,name,level){
  if(!currentUser) return;
  const text = prompt(`–û—Ç–≤–µ—Ç –¥–ª—è ${name}:`);
  if(!text) return;

  db.doc(path).collection("replies").add({
    name: currentUser,
    text: text,
    likes:0,
    dislikes:0,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
}

async function deleteComment(path){
  const ref = db.doc(path);
  const replies = await ref.collection("replies").get();
  for(const r of replies.docs){
    await deleteComment(r.ref.path);
  }
  await ref.delete();
}

let index=0;
function moveSlide(step){
  const slides = document.getElementById("slides");
  const total = slides.children.length;
  const width = slides.children[0].offsetWidth + 15;
  index += step;
  if(index<0) index=total-1;
  if(index>=total) index=0;
  slides.style.transform = "translateX(-"+index*width+"px)";
}

</script>
</div>
</body>
</html>


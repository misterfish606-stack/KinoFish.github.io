<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–•–æ—Ä–æ—à–∏–π, –ø–ª–æ—Ö–æ–π, –∑–ª–æ–π (1966)</title>

<style>
.comment {
  background:#1e1e1e;
  padding:12px;
  border-radius:10px;
  margin-bottom:10px;
  color:white;
}

.comment .actions button{
  margin-right:8px;
  cursor:pointer;
}

.reply-block{
  border-left:3px solid #444;
  margin-top:10px;
  padding-left:15px;
}

.menu{
  position:relative;
  display:inline-block;
  float:right;
}

.menu-content{
  position:absolute;
  right:0;
  background:#2a2a2a;
  border-radius:6px;
  padding:5px;
  z-index:10;
}

.menu-content button{
  display:block;
  background:none;
  border:none;
  color:white;
  padding:5px 10px;
  cursor:pointer;
  width:100%;
  text-align:left;
}
</style>
</head>
<body>
<div class="wrapper">

<h2>–•–æ—Ä–æ—à–∏–π, –ø–ª–æ—Ö–æ–π, –∑–ª–æ–π (1966)</h2>

<div class="slider">
  <div class="slides" id="slides">
    <img src="https://upload.wikimedia.org/wikipedia/en/4/45/Good_the_bad_and_the_ugly_poster.jpg">
    <img src="https://m.media-amazon.com/images/I/91z+4nW6zRL._AC_SL1500_.jpg">
    <img src="https://upload.wikimedia.org/wikipedia/commons/2/22/The_Good_the_Bad_and_the_Ugly.jpg">
  </div>
  <button class="prev" onclick="moveSlide(-1)">‚ùÆ</button>
  <button class="next" onclick="moveSlide(1)">‚ùØ</button>
</div>

<div class="top">
  <div class="poster">
    <img src="https://i.imgur.com/XKxOxxg.jpg">
  </div>
  <div class="info-block">
    <p><b>–ü—Ä–æ—Å–º–æ—Ç—Ä—ã:</b> <span id="viewCount">0</span></p>
  </div>
</div>

<div class="description">–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä—ë—Ö –æ—Ö–æ—Ç–Ω–∏–∫–æ–≤ –∑–∞ —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–∞ –ì—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–π –≤–æ–π–Ω—ã –≤ –°–®–ê.</div>

<div class="video-container">
  <iframe src="https://www.youtube.com/embed/0Bwxz16-T04" allowfullscreen></iframe>
</div>

<h3>–í—Ö–æ–¥</h3>
<input type="text" id="loginName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
<button onclick="login()">–í–æ–π—Ç–∏</button>
<p id="currentUser"></p>

<h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
<input type="text" id="commentInput" placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π">
<button id="sendComment">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
<div id="commentList"></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
let comments = JSON.parse(localStorage.getItem("comments") || "[]");

function saveComments(){
  localStorage.setItem("comments", JSON.stringify(comments));
}

function renderComments(){
  const container = document.getElementById("commentList");
  container.innerHTML = "";
  comments.forEach(c => container.appendChild(createCommentElement(c)));
}

function createCommentElement(comment, level = 0){
  const div = document.createElement("div");
  div.className = "comment";
  if(level > 0) div.classList.add("reply-block");

  div.innerHTML = `
    <div>
      <strong>${comment.author}</strong>
      <div class="menu">
        <button onclick="toggleMenu('${comment.id}')">‚ãÆ</button>
        <div class="menu-content" id="menu-${comment.id}"></div>
      </div>
    </div>
    <p id="text-${comment.id}">${comment.text}</p>
    <div class="actions">
      <button onclick="like('${comment.id}')">üëç ${comment.likes}</button>
      <button onclick="dislike('${comment.id}')">üëé ${comment.dislikes}</button>
    </div>
    <div id="replies-${comment.id}"></div>
  `;

  if(comment.replies){
    comment.replies.forEach(r => {
      div.querySelector(`#replies-${comment.id}`)
         .appendChild(createCommentElement(r, level+1));
    });
  }

  return div;
}

function toggleMenu(id){
  document.querySelectorAll(".menu-content").forEach(m => m.innerHTML="");
  const menu = document.getElementById("menu-"+id);
  const comment = findComment(id);

  if(comment.author === "You"){
    menu.innerHTML = `<button onclick="deleteComment('${id}')">–£–¥–∞–ª–∏—Ç—å</button>`;
  } else {
    menu.innerHTML = `<button onclick="replyTo('${id}')">–û—Ç–≤–µ—Ç–∏—Ç—å</button>`;
  }
}

function findComment(id, list = comments){
  for(let c of list){
    if(c.id === id) return c;
    if(c.replies){
      const found = findComment(id, c.replies);
      if(found) return found;
    }
  }
  return null;
}

function like(id){
  const c = findComment(id);
  c.likes++;
  saveComments();
  renderComments();
}

function dislike(id){
  const c = findComment(id);
  c.dislikes++;
  saveComments();
  renderComments();
}

function replyTo(id){
  const parent = findComment(id);
  const text = prompt("–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç:");
  if(!text) return;

  const reply = {
    id: Date.now().toString(),
    author: "You",
    text,
    likes:0,
    dislikes:0,
    replies:[]
  };

  parent.replies = parent.replies || [];
  parent.replies.push(reply);

  saveComments();
  renderComments();

  setTimeout(()=>{
    const el = document.getElementById("text-"+id);
    if(el) el.scrollIntoView({behavior:"smooth", block:"center"});
  },100);
}

function deleteComment(id, list = comments){
  for(let i=0;i<list.length;i++){
    if(list[i].id === id){
      list.splice(i,1);
      saveComments();
      renderComments();
      return true;
    }
    if(list[i].replies && deleteComment(id, list[i].replies)){
      return true;
    }
  }
  return false;
}

function addComment(){
  const input = document.getElementById("commentInput");
  if(!input.value.trim()) return;

  comments.push({
    id: Date.now().toString(),
    author:"You",
    text:input.value,
    likes:0,
    dislikes:0,
    replies:[]
  });

  input.value="";
  saveComments();
  renderComments();
}

renderComments();
</script>
</div>
</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Хороший, плохой, злой (1966)</title>

<style>
body{margin:0;font-family:'Arial Black',sans-serif;background:#1b0000;color:#eee;overflow-x:hidden;}
.wrapper{width:70%;margin:0 auto;padding-bottom:60px;}
body::after{content:"";position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:999;background-image:radial-gradient(2px 2px at 20px 30px, rgba(255,220,180,0.4), transparent),radial-gradient(2px 2px at 100px 80px, rgba(255,220,180,0.4), transparent),radial-gradient(2px 2px at 200px 150px, rgba(255,220,180,0.4), transparent),radial-gradient(2px 2px at 300px 50px, rgba(255,220,180,0.4), transparent);background-repeat:repeat;background-size:400px 400px;animation:dust 20s linear infinite;}
@keyframes dust{from{transform:translateY(0);}to{transform:translateY(-400px);}}
.slider{position:relative;margin-top:20px;overflow:hidden;border-radius:10px;height:200px;background:#220000;padding:10px;box-shadow:0 0 15px #900;}
.slides{display:flex;transition:0.5s;}
.slides img{width:300px;margin-right:15px;border-radius:5px;cursor:pointer;transition:0.3s;}
.slides img:hover{transform:scale(1.05);}
.prev,.next{position:absolute;top:50%;transform:translateY(-50%);background:#330000;border:none;color:white;font-size:20px;padding:8px;cursor:pointer;border-radius:5px;}
.prev{left:5px;}
.next{right:5px;}
.top{display:flex;gap:30px;margin-top:30px;}
.poster img{width:250px;border-radius:10px;box-shadow:0 0 20px #900;}
.info-block{display:flex;flex-direction:column;justify-content:flex-start;}
.description{margin-top:30px;line-height:1.6;padding:15px;background:#220000;border-radius:10px;box-shadow:0 0 15px #900;}
.video-container{margin-top:30px;}
.video-container iframe{width:100%;height:500px;border-radius:10px;box-shadow:0 0 25px #900;}
button{padding:6px 10px;background:#330000;color:white;border:1px solid #aa0000;border-radius:5px;cursor:pointer;margin-top:5px;}
button:hover{background:#660000;}
.star{font-size:24px;color:#550000;cursor:pointer;}.star.selected{color:gold;}#avgRating{font-size:18px;color:gold;margin-top:10px;}
.comment{background:#140000;padding:10px;margin-top:10px;border-left:4px solid #aa0000;border-radius:5px;position:relative;}
.comment .menu{position:absolute;top:5px;right:5px;cursor:pointer;font-weight:bold;}
.comment .replies{margin-left:20px;margin-top:5px;}
.reply-input{margin-top:5px;width:80%;}
</style>
</head>
<body>
<div class="wrapper">

<h2>Хороший, плохой, злой (1966)</h2>

<div class="slider">
  <div class="slides" id="slides">
    <img src="https://upload.wikimedia.org/wikipedia/en/4/45/Good_the_bad_and_the_ugly_poster.jpg">
    <img src="https://m.media-amazon.com/images/I/91z+4nW6zRL._AC_SL1500_.jpg">
    <img src="https://upload.wikimedia.org/wikipedia/commons/2/22/The_Good_the_Bad_and_the_Ugly.jpg">
  </div>
  <button class="prev" onclick="moveSlide(-1)">❮</button>
  <button class="next" onclick="moveSlide(1)">❯</button>
</div>

<div class="top">
  <div class="poster">
    <img src="https://i.imgur.com/XKxOxxg.jpg">
  </div>
  <div class="info-block">
    <p><b>Оригинальное название:</b> The Good, the Bad and the Ugly</p>
    <p><b>Страны:</b> Италия, Испания</p>
    <p><b>Жанр:</b> Вестерн / Экшн</p>
    <p><b>Рейтинг КиноПоиск:</b> 8.6</p>
    <p><b>Рейтинг IMDb:</b> 8.8</p>
    <p><b>Режиссёр:</b> Серджо Леоне</p>
    <p><b>Актёры:</b> Клинт Иствуд, Ли Ван Клиф, Илай Уоллак</p>
    <p id="viewCount"><b>Просмотры:</b> 0</p>
    <div id="avgRating">Средний рейтинг: ⭐0.0</div>
    <div>
      <span class="star" data-value="1">★</span>
      <span class="star" data-value="2">★</span>
      <span class="star" data-value="3">★</span>
      <span class="star" data-value="4">★</span>
      <span class="star" data-value="5">★</span>
      <span id="votes">(0 голосов)</span>
    </div>
  </div>
</div>

<div class="description">История трёх охотников за сокровищами во времена Гражданской войны в США.</div>

<div class="video-container">
  <iframe src="https://www.youtube.com/embed/0Bwxz16-T04?enablejsapi=1" allowfullscreen></iframe>
</div>

<h3>Вход</h3>
<input type="text" id="loginName" placeholder="Введите имя">
<button onclick="login()">Войти</button>
<p id="currentUser"></p>

<h3>Комментарии</h3>
<input type="text" id="commentInput" placeholder="Ваш комментарий">
<button id="sendComment">Отправить</button>
<div id="commentList"></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyCTr1vgcuSEn_2Ebh2vC3k7sNYzvMoYlBo",
  authDomain: "kino-project-bf21c.firebaseapp.com",
  projectId: "kino-project-bf21c",
  storageBucket: "kino-project-bf21c.firebasestorage.app",
  messagingSenderId: "603398460201",
  appId: "1:603398460201:web:42612fab9d600222985d38"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let currentUser = localStorage.getItem("currentUser") || null;
function login(){
  const name = document.getElementById("loginName").value.trim();
  if(!name) return;
  currentUser = name;
  localStorage.setItem("currentUser", name);
  document.getElementById("currentUser").innerText = "Вы вошли как: " + name;
}
if(currentUser){document.getElementById("currentUser").innerText = "Вы вошли как: " + currentUser;}

// ===================== Комментарии =====================
document.getElementById("sendComment").addEventListener("click", async ()=>{
  if(!currentUser){alert("Сначала войдите!");return;}
  const text = document.getElementById("commentInput").value.trim();
  if(!text) return;
  await db.collection("comments").add({name:currentUser,text:text,likes:0,dislikes:0,timestamp:firebase.firestore.FieldValue.serverTimestamp()});
  document.getElementById("commentInput").value="";
});

// ===================== Отображение комментариев с ответами и удалением =====================
db.collection("comments").orderBy("timestamp","desc").onSnapshot(snapshot=>{
  const container = document.getElementById("commentList");
  container.innerHTML = "";
  snapshot.forEach(doc=>{
    const c = doc.data();
    const div = document.createElement("div");
    div.className = "comment";
    div.innerHTML = `<div class='menu' onclick='deleteComment("${doc.id}")'>⋮</div><b>${c.name}</b>: ${c.text}<br><input class='reply-input' placeholder='Ответ...' id='reply-${doc.id}'><button onclick='replyComment("${doc.id}")'>Ответить</button><div class='replies' id='replies-${doc.id}'></div>`;
    container.appendChild(div);
  });
});

async function deleteComment(id){
  const doc = await db.collection("comments").doc(id).get();
  if(doc.exists && doc.data().name===currentUser){
    await db.collection("comments").doc(id).delete();
  }else{alert('Удалить можно только свой комментарий!');}
}

async function replyComment(id){
  const replyText = document.getElementById(`reply-${id}`).value.trim();
  if(!replyText || !currentUser) return;
  await db.collection("comments").doc(id).collection('replies').add({name:currentUser,text:replyText,timestamp:firebase.firestore.FieldValue.serverTimestamp()});
  document.getElementById(`reply-${id}`).value="";
}
</script>

<script>
// ===================== Рейтинг =====================
document.addEventListener("DOMContentLoaded", function(){
  let stars=document.querySelectorAll('.star');
  function loadRating(){
    let totalVotes=parseInt(localStorage.getItem('totalVotes'))||0;
    let totalScore=parseInt(localStorage.getItem('totalScore'))||0;
    let avg=totalVotes?(totalScore/totalVotes).toFixed(1):"0.0";
    document.getElementById('votes').innerText=`(${totalVotes} голосов)`;
    document.getElementById('avgRating').innerText=`Средний рейтинг: ⭐${avg}`;
  }
  stars.forEach((star)=>{star.addEventListener('click',()=>{
    if(localStorage.getItem("voted")) return;
    let val=parseInt(star.getAttribute('data-value'));
    let totalVotes=parseInt(localStorage.getItem('totalVotes'))||0;
    let totalScore=parseInt(localStorage.getItem('totalScore'))||0;
    totalVotes++;totalScore+=val;
    localStorage.setItem('totalVotes',totalVotes);
    localStorage.setItem('totalScore',totalScore);
    localStorage.setItem('voted',true);
    loadRating();
  });});
  loadRating();

  // ===================== Слайдер =====================
  let index=0;
  window.moveSlide=function(step){
    const slides = document.getElementById("slides");
    const total = slides.children.length;
    const width = slides.children[0].offsetWidth + 15;
    index += step;if(index<0) index=total-1;if(index>=total) index=0;
    slides.style.transform = "translateX(-"+index*width+"px)";
  }

  // ===================== Просмотры =====================
  let views = parseInt(localStorage.getItem("views")) || 0;
  views++; localStorage.setItem("views", views);
  document.getElementById("viewCount").innerHTML = "<b>Просмотры:</b> " + views;
});
</script>
</div>
</body>
</html>

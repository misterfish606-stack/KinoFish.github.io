<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–•–æ—Ä–æ—à–∏–π, –ø–ª–æ—Ö–æ–π, –∑–ª–æ–π (1966)</title>
<style>
body{margin:0;font-family:'Arial Black',sans-serif;background:#1b0000;color:#eee;overflow-x:hidden;}
.wrapper{width:70%;margin:0 auto;padding-bottom:60px;}
body::after{content:"";position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:999;
background-image:radial-gradient(2px 2px at 20px 30px, rgba(255,220,180,0.4), transparent),
radial-gradient(2px 2px at 100px 80px, rgba(255,220,180,0.4), transparent),
radial-gradient(2px 2px at 200px 150px, rgba(255,220,180,0.4), transparent),
radial-gradient(2px 2px at 300px 50px, rgba(255,220,180,0.4), transparent);
background-repeat:repeat;background-size:400px 400px;animation:dust 20s linear infinite;}
@keyframes dust{from{transform:translateY(0);}to{transform:translateY(-400px);}}
.slider{position:relative;margin-top:20px;overflow:hidden;border-radius:10px;height:200px;background:#220000;padding:10px;box-shadow:0 0 15px #900;}
.slides{display:flex;transition:0.5s;}
.slides img{width:300px;margin-right:15px;border-radius:5px;cursor:pointer;transition:0.3s;}
.slides img:hover{transform:scale(1.05);}
.prev,.next{position:absolute;top:50%;transform:translateY(-50%);background:#330000;border:none;color:white;font-size:20px;padding:8px;cursor:pointer;border-radius:5px;}
.prev{left:5px;} .next{right:5px;}
.top{display:flex;gap:30px;margin-top:30px;}
.poster img{width:250px;border-radius:10px;box-shadow:0 0 20px #900;}
.info-block{display:flex;flex-direction:column;justify-content:flex-start;}
.description{margin-top:30px;line-height:1.6;padding:15px;background:#220000;border-radius:10px;box-shadow:0 0 15px #900;}
.video-container{margin-top:30px;}
video{width:100%;height:500px;border-radius:10px;box-shadow:0 0 25px #900;}
button{padding:6px 10px;background:#330000;color:white;border:1px solid #aa0000;border-radius:5px;cursor:pointer;margin-top:5px;}
button:hover{background:#660000;}
.star{font-size:24px;color:#550000;cursor:pointer;}
.star.selected{color:gold;}
#avgRating{font-size:18px;color:gold;margin-top:10px;}
.comment{background:#140000;padding:10px;margin-top:10px;border-left:4px solid #aa0000;border-radius:5px;}
</style>
</head>
<body>
<div class="wrapper">

<h2>–•–æ—Ä–æ—à–∏–π, –ø–ª–æ—Ö–æ–π, –∑–ª–æ–π (1966)</h2>

<!-- –°–ª–∞–π–¥–µ—Ä -->
<div class="slider">
  <div class="slides" id="slides">
    <img src="https://upload.wikimedia.org/wikipedia/en/4/45/Good_the_bad_and_the_ugly_poster.jpg">
    <img src="https://m.media-amazon.com/images/I/91z+4nW6zRL._AC_SL1500_.jpg">
    <img src="https://upload.wikimedia.org/wikipedia/commons/2/22/The_Good_the_Bad_and_the_Ugly.jpg">
  </div>
  <button class="prev" onclick="moveSlide(-1)">‚ùÆ</button>
  <button class="next" onclick="moveSlide(1)">‚ùØ</button>
</div>

<!-- –ò–Ω—Ñ–æ -->
<div class="top">
  <div class="poster">
    <img src="https://i.imgur.com/XKxOxxg.jpg">
  </div>
  <div class="info-block">
    <p><b>–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:</b> The Good, the Bad and the Ugly</p>
    <p><b>–°—Ç—Ä–∞–Ω—ã:</b> –ò—Ç–∞–ª–∏—è, –ò—Å–ø–∞–Ω–∏—è</p>
    <p><b>–ñ–∞–Ω—Ä:</b> –í–µ—Å—Ç–µ—Ä–Ω / –≠–∫—à–Ω</p>
    <p><b>–†–µ–π—Ç–∏–Ω–≥ –ö–∏–Ω–æ–ü–æ–∏—Å–∫:</b> 8.6</p>
    <p><b>–†–µ–π—Ç–∏–Ω–≥ IMDb:</b> 8.8</p>
    <p><b>–†–µ–∂–∏—Å—Å—ë—Ä:</b> –°–µ—Ä–¥–∂–æ –õ–µ–æ–Ω–µ</p>
    <p><b>–ê–∫—Ç—ë—Ä—ã:</b> –ö–ª–∏–Ω—Ç –ò—Å—Ç–≤—É–¥, –õ–∏ –í–∞–Ω –ö–ª–∏—Ñ, –ò–ª–∞–π –£–æ–ª–ª–∞–∫</p>
    <p id="viewCount"><b>–ü—Ä–æ—Å–º–æ—Ç—Ä—ã:</b> 0</p>
    <div id="avgRating">–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥: ‚≠ê0.0</div>
    <div>
      <span class="star" data-value="1">‚òÖ</span>
      <span class="star" data-value="2">‚òÖ</span>
      <span class="star" data-value="3">‚òÖ</span>
      <span class="star" data-value="4">‚òÖ</span>
      <span class="star" data-value="5">‚òÖ</span>
      <span id="votes">(0 –≥–æ–ª–æ—Å–æ–≤)</span>
    </div>
  </div>
</div>

<div class="description">
–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä—ë—Ö –æ—Ö–æ—Ç–Ω–∏–∫–æ–≤ –∑–∞ —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–∞ –ì—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–π –≤–æ–π–Ω—ã –≤ –°–®–ê.
</div>

<!-- –í–∏–¥–µ–æ -->
<div class="video-container">
  <video controls>
    <source src="https://example.com/movie.mp4" type="video/mp4">
    –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
  </video>
</div>

<!-- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
<h3>–í—Ö–æ–¥</h3>
<input type="text" id="loginName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
<button onclick="login()">–í–æ–π—Ç–∏</button>
<p id="currentUser"></p>

<h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
<input type="text" id="commentInput" placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π">
<button id="sendComment">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
<div id="commentList"></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
<!-- HTML –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ—Ç –∂–µ, –º–µ–Ω—è–µ–º —Ç–æ–ª—å–∫–æ JS -->
<script>
// ===================== Firebase =====================
const firebaseConfig = {
  apiKey: "AIzaSyCTr1vgcuSEn_2Ebh2vC3k7sNYzvMoYlBo",
  authDomain: "kino-project-bf21c.firebaseapp.com",
  projectId: "kino-project-bf21c",
  storageBucket: "kino-project-bf21c.firebasestorage.app",
  messagingSenderId: "603398460201",
  appId: "1:603398460201:web:42612fab9d600222985d38"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ===================== –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è =====================
let currentUser = localStorage.getItem("currentUser") || null;
function login(){
  const name = document.getElementById("loginName").value.trim();
  if(!name) return;
  currentUser = name;
  localStorage.setItem("currentUser", name);
  document.getElementById("currentUser").innerText = "–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: " + name;
}
if(currentUser){
  document.getElementById("currentUser").innerText = "–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: " + currentUser;
}

// ===================== –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ =====================
document.getElementById("sendComment").addEventListener("click", async ()=>{
  if(!currentUser){ alert("–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ!"); return; }
  const text = document.getElementById("commentInput").value.trim();
  if(!text) return;
  await db.collection("comments").add({
    name: currentUser,
    text: text,
    likes:0,
    dislikes:0,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
  document.getElementById("commentInput").value="";
});

db.collection("comments").orderBy("timestamp","desc")
.onSnapshot(snapshot=>{
  const container = document.getElementById("commentList");
  container.innerHTML = "";
  snapshot.forEach(doc=>{
    const c = doc.data();
    const div = document.createElement("div");
    div.className = "comment";
    let liked = JSON.parse(localStorage.getItem(`liked_${doc.id}`)) || false;
    let disliked = JSON.parse(localStorage.getItem(`disliked_${doc.id}`)) || false;
    div.innerHTML = `<b>${c.name}</b>: ${c.text}<br>
      <button onclick="likeComment('${doc.id}',this)" ${liked?"disabled":""}>üëç ${c.likes||0}</button>
      <button onclick="dislikeComment('${doc.id}',this)" ${disliked?"disabled":""}>üëé ${c.dislikes||0}</button>`;
    container.appendChild(div);
  });
});

async function likeComment(id, btn){
  if(JSON.parse(localStorage.getItem(`liked_${id}`))) return;
  const ref = db.collection("comments").doc(id);
  await db.runTransaction(async t=>{
    const doc = await t.get(ref);
    if(!doc.exists) return;
    t.update(ref,{likes:(doc.data().likes||0)+1});
  });
  localStorage.setItem(`liked_${id}`, true);
  btn.disabled = true;
}

async function dislikeComment(id, btn){
  if(JSON.parse(localStorage.getItem(`disliked_${id}`))) return;
  const ref = db.collection("comments").doc(id);
  await db.runTransaction(async t=>{
    const doc = await t.get(ref);
    if(!doc.exists) return;
    t.update(ref,{dislikes:(doc.data().dislikes||0)+1});
  });
  localStorage.setItem(`disliked_${id}`, true);
  btn.disabled = true;
}

// ===================== –ü—Ä–æ—Å–º–æ—Ç—Ä—ã –≤ Firebase =====================
const viewDoc = db.collection("movies").doc("good_bad_ugly");

async function updateViews(){
  await db.runTransaction(async t=>{
    const doc = await t.get(viewDoc);
    if(!doc.exists){
      t.set(viewDoc, {views:1, totalVotes:0, totalScore:0});
    } else {
      const views = doc.data().views || 0;
      t.update(viewDoc,{views:views+1});
    }
  });
}

// –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
updateViews();
viewDoc.onSnapshot(doc=>{
  const data = doc.data();
  if(data) document.getElementById("viewCount").innerHTML = "<b>–ü—Ä–æ—Å–º–æ—Ç—Ä—ã:</b> " + (data.views || 0);
});

// ===================== –†–µ–π—Ç–∏–Ω–≥ –≤ Firebase =====================
document.addEventListener("DOMContentLoaded", function() {
  const stars = document.querySelectorAll('.star');

  async function loadRating(){
    const doc = await viewDoc.get();
    if(doc.exists){
      const data = doc.data();
      const avg = (data.totalVotes ? (data.totalScore / data.totalVotes).toFixed(1) : "0.0");
      document.getElementById('votes').innerText = `(${data.totalVotes || 0} –≥–æ–ª–æ—Å–æ–≤)`;
      document.getElementById('avgRating').innerText = `–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥: ‚≠ê${avg}`;
    }
  }

  stars.forEach(star=>{
    star.addEventListener('click', async ()=>{
      if(localStorage.getItem("voted")) return;
      const val = parseInt(star.getAttribute('data-value'));
      await db.runTransaction(async t=>{
        const doc = await t.get(viewDoc);
        if(!doc.exists){
          t.set(viewDoc,{views:0, totalVotes:1, totalScore:val});
        } else {
          const data = doc.data();
          t.update(viewDoc,{
            totalVotes:(data.totalVotes||0)+1,
            totalScore:(data.totalScore||0)+val
          });
        }
      });
      localStorage.setItem('voted',true);
      loadRating();
    });
  });

  loadRating();
});

// ===================== –°–ª–∞–π–¥–µ—Ä =====================
let index=0;
function moveSlide(step){
  const slides = document.getElementById("slides");
  const total = slides.children.length;
  const width = slides.children[0].offsetWidth + 15;
  index += step;
  if(index<0) index=total-1;
  if(index>=total) index=0;
  slides.style.transform = "translateX(-"+index*width+"px)";
}
</script>



</script>
</div>
</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Хороший, плохой, злой</title>

<style>
body{
margin:0;
font-family:Georgia, serif;
background:linear-gradient(to bottom,#3a2c1a,#1a1208);
color:#f5e6c4;
}

.container{
display:flex;
gap:40px;
padding:40px;
}

.poster img{
width:300px;
border:5px solid #d4af37;
box-shadow:0 0 20px black;
}

h2,h3{
color:#d4af37;
text-shadow:2px 2px 5px black;
}

a{color:#ffd700;text-decoration:none}
a:hover{text-decoration:underline}

.info{max-width:700px}

textarea{
width:100%;
padding:10px;
margin-top:10px;
background:#2c1c0e;
color:white;
border:1px solid #d4af37;
}

button{
background:#5a3e1b;
color:white;
border:none;
padding:8px 14px;
margin-top:8px;
cursor:pointer;
}

button:hover{background:#8b5a2b}

.comment{
background:#2c1c0e;
padding:10px;
margin-top:10px;
border-left:3px solid #d4af37;
}

.reply{
margin-left:30px;
border-left:3px solid #aaa;
}

.modal{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:rgba(0,0,0,0.85);
display:flex;
justify-content:center;
align-items:center;
}

.hidden{display:none;}

.modal-box{
background:#1b1b1b;
padding:30px;
width:400px;
position:relative;
border:2px solid #d4af37;
}

.close{
position:absolute;
right:10px;
top:10px;
cursor:pointer;
color:red;
font-size:20px;
}
</style>
</head>
<body>

<div style="padding:20px">
<input id="nickname" placeholder="Ваш ник">
<button onclick="login()">Войти</button>
<span id="loginError" style="color:red"></span>
</div>

<div class="container">

<div class="poster">
<img src="https://upload.wikimedia.org/wikipedia/en/4/45/Good_the_bad_and_the_ugly_poster.jpg">
<h2>Хороший, плохой, злой</h2>
</div>

<div class="info">

<p><b>Год:</b> 1966</p>

<p><b>Оригинальное название:</b>
<a href="https://www.imdb.com/title/tt0060196/" target="_blank">
The Good, the Bad and the Ugly
</a></p>

<p><b>Страна:</b>
<a href="https://ru.wikipedia.org/wiki/Италия" target="_blank">Италия</a>,
<a href="https://ru.wikipedia.org/wiki/Испания" target="_blank">Испания</a>
</p>

<p><b>Жанр:</b>
<a href="https://ru.wikipedia.org/wiki/Вестерн" target="_blank">Вестерн</a>
</p>

<p><b>Режиссёр:</b>
<a href="https://ru.wikipedia.org/wiki/Леоне,_Серджо" target="_blank">
Серджио Леоне
</a>
</p>

<p><b>IMDb:</b>
<a href="https://www.imdb.com/title/tt0060196/" target="_blank">
8.8 / 10
</a></p>

<p><b>Кинопоиск:</b>
<a href="https://www.kinopoisk.ru/film/349/" target="_blank">
8.5 / 10
</a></p>

<h3>Описание</h3>
<p>
Легендарный спагетти-вестерн режиссёра Серджио Леоне.
Три стрелка во времена Гражданской войны в США
охотятся за золотом Конфедерации.
Каждый преследует свою выгоду, но судьба снова и снова
сталкивает их вместе.
Фильм прославился напряжёнными дуэлями и культовой музыкой Эннио Морриконе.
</p>

<h3>Трейлер</h3>
<iframe width="560" height="315"
src="https://www.youtube.com/embed/WCN5JJY_wiA"
allowfullscreen></iframe>

<h3>Комментарии</h3>
<div id="comments"></div>

<textarea id="commentInput" placeholder="Ваш комментарий"></textarea>
<button onclick="addComment()">Отправить</button>

</div>
</div>

<div id="modal" class="modal hidden">
<div class="modal-box">
<span class="close" onclick="closeModal()">✖</span>
<textarea id="modalText"></textarea>
<button onclick="saveReply()">Ответить</button>
</div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
firebase.initializeApp({
apiKey: "AIzaSyCTr1vgcuSEn_2Ebh2vC3k7sNYzvMoYlBo",
authDomain: "kino-project-bf21c.firebaseapp.com",
projectId: "kino-project-bf21c"
});

const db=firebase.firestore();
let currentUser=null;
let replyTo=null;

async function login(){
const nick=document.getElementById("nickname").value.trim();
if(!nick)return;
currentUser=nick;
alert("Вы вошли как "+nick);
}

function renderComment(doc,parent=null){
const data=doc.data();
const div=document.createElement("div");
div.className="comment";
if(parent)div.classList.add("reply");

div.innerHTML=`
<b>${data.user}</b>
<p>${data.text}</p>
<button onclick="openReply('${doc.id}')">Ответить</button>
`;

(parent||document.getElementById("comments")).appendChild(div);

db.collection("comments")
.where("parent","==",doc.id)
.onSnapshot(snap=>{
snap.forEach(d=>renderComment(d,div));
});
}

db.collection("comments")
.where("parent","==",null)
.onSnapshot(snap=>{
document.getElementById("comments").innerHTML="";
snap.forEach(doc=>renderComment(doc));
});

async function addComment(parent=null,text=null){
if(!currentUser)return alert("Войдите");
const value=text||document.getElementById("commentInput").value;
if(!value)return;

await db.collection("comments").add({
user:currentUser,
text:value,
parent:parent||null,
created:Date.now()
});
document.getElementById("commentInput").value="";
}

function openReply(id){
replyTo=id;
document.getElementById("modal").classList.remove("hidden");
}

function closeModal(){
document.getElementById("modal").classList.add("hidden");
}

async function saveReply(){
const text=document.getElementById("modalText").value;
if(text)await addComment(replyTo,text);
document.getElementById("modalText").value="";
closeModal();
}
</script>

</body>
</html>


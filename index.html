<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–•–æ—Ä–æ—à–∏–π, –ø–ª–æ—Ö–æ–π, –∑–ª–æ–π (1966)</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#140000;
  color:#eee;
}

.wrapper{
  width:75%;
  margin:auto;
  padding-bottom:50px;
}

h2{margin-top:20px;}

.slider{
  margin-top:20px;
  overflow:hidden;
  position:relative;
  height:220px;
  background:#220000;
  border-radius:10px;
}

.slides{
  display:flex;
  transition:0.5s;
}

.slides img{
  width:300px;
  margin-right:15px;
  border-radius:8px;
}

.prev,.next{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  background:#330000;
  border:none;
  color:white;
  padding:8px;
  cursor:pointer;
}

.prev{left:5px;}
.next{right:5px;}

.top{
  display:flex;
  gap:30px;
  margin-top:30px;
}

.poster img{
  width:250px;
  border-radius:10px;
}

.description{
  margin-top:20px;
  padding:15px;
  background:#220000;
  border-radius:10px;
}

.comment{
  background:#1c1c1c;
  padding:12px;
  margin-top:10px;
  border-radius:8px;
}

.replies{
  margin-left:30px;
  margin-top:10px;
  border-left:2px solid #333;
  padding-left:10px;
}

button{
  background:#330000;
  color:white;
  border:1px solid #aa0000;
  border-radius:5px;
  padding:5px 8px;
  cursor:pointer;
  margin-top:5px;
}

button:hover{
  background:#660000;
}

.star{
  font-size:22px;
  cursor:pointer;
  color:#555;
}

.star.active{
  color:gold;
}
</style>
</head>
<body>

<div class="wrapper">

<h2>–•–æ—Ä–æ—à–∏–π, –ø–ª–æ—Ö–æ–π, –∑–ª–æ–π (1966)</h2>

<!-- –°–ª–∞–π–¥–µ—Ä -->
<div class="slider">
  <div class="slides" id="slides">
    <img src="https://upload.wikimedia.org/wikipedia/en/4/45/Good_the_bad_and_the_ugly_poster.jpg">
    <img src="https://upload.wikimedia.org/wikipedia/commons/2/22/The_Good_the_Bad_and_the_Ugly.jpg">
  </div>
  <button class="prev" onclick="moveSlide(-1)">‚ùÆ</button>
  <button class="next" onclick="moveSlide(1)">‚ùØ</button>
</div>

<!-- –ò–Ω—Ñ–æ -->
<div class="top">
  <div class="poster">
    <img src="https://upload.wikimedia.org/wikipedia/en/4/45/Good_the_bad_and_the_ugly_poster.jpg">
  </div>

  <div>
    <p><b>–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:</b> The Good, the Bad and the Ugly</p>
    <p><b>–ñ–∞–Ω—Ä:</b> –í–µ—Å—Ç–µ—Ä–Ω</p>
    <p id="viewCount">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã: 0</p>

    <div>
      <span class="star" data="1">‚òÖ</span>
      <span class="star" data="2">‚òÖ</span>
      <span class="star" data="3">‚òÖ</span>
      <span class="star" data="4">‚òÖ</span>
      <span class="star" data="5">‚òÖ</span>
      <span id="ratingInfo"></span>
    </div>
  </div>
</div>

<div class="description">
–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä—ë—Ö –æ—Ö–æ—Ç–Ω–∏–∫–æ–≤ –∑–∞ —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–∞ –ì—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–π –≤–æ–π–Ω—ã –≤ –°–®–ê.
</div>

<hr>

<h3>–í—Ö–æ–¥</h3>
<input type="text" id="loginName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
<button onclick="login()">–í–æ–π—Ç–∏</button>
<p id="currentUser"></p>

<h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
<input type="text" id="commentInput" placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π">
<button onclick="addComment()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
<div id="commentList"></div>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>

const firebaseConfig = {
  // –í–°–¢–ê–í–¨ –°–í–û–ò –ö–õ–Æ–ß–ò
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let userId = localStorage.getItem("userId");
if(!userId){
  userId = "user_" + Math.random().toString(36).substr(2,9);
  localStorage.setItem("userId", userId);
}

// ===== –í–•–û–î =====
let currentUser = localStorage.getItem("currentUser");

function login(){
  const name = document.getElementById("loginName").value.trim();
  if(!name) return;
  currentUser = name;
  localStorage.setItem("currentUser", name);
  document.getElementById("currentUser").innerText = "–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: " + name;
}

if(currentUser){
  document.getElementById("currentUser").innerText = "–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: " + currentUser;
}

// ===== –ü–†–û–°–ú–û–¢–†–´ 1 –†–ê–ó =====
const viewRef = db.collection("stats").doc("views");

if(!localStorage.getItem("viewed")){
  viewRef.set({
    count: firebase.firestore.FieldValue.increment(1)
  },{merge:true});
  localStorage.setItem("viewed","yes");
}

viewRef.onSnapshot(doc=>{
  if(doc.exists){
    document.getElementById("viewCount").innerText =
      "–ü—Ä–æ—Å–º–æ—Ç—Ä—ã: " + doc.data().count;
  }
});

// ===== –†–ï–ô–¢–ò–ù–ì 1 –†–ê–ó =====
const ratingRef = db.collection("stats").doc("rating");

function loadRating(){
  ratingRef.get().then(doc=>{
    if(!doc.exists) return;
    const d = doc.data();
    const avg = d.totalVotes ?
      (d.totalScore/d.totalVotes).toFixed(1) : "0.0";
    document.getElementById("ratingInfo").innerText =
      " (" + avg + " –∏–∑ 5)";
  });
}
loadRating();

document.querySelectorAll(".star").forEach(star=>{
  star.addEventListener("click",()=>{
    if(!currentUser){ alert("–í–æ–π–¥–∏—Ç–µ!"); return; }
    if(localStorage.getItem("rated")) return;

    const val = parseInt(star.getAttribute("data"));

    ratingRef.set({
      totalScore: firebase.firestore.FieldValue.increment(val),
      totalVotes: firebase.firestore.FieldValue.increment(1)
    },{merge:true}).then(loadRating);

    localStorage.setItem("rated","yes");
  });
});

// ===== –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò =====
function addComment(){
  if(!currentUser){ alert("–í–æ–π–¥–∏—Ç–µ!"); return; }
  const text = document.getElementById("commentInput").value.trim();
  if(!text) return;

  db.collection("comments").add({
    name: currentUser,
    text: text,
    likes:0,
    dislikes:0,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });

  document.getElementById("commentInput").value="";
}

db.collection("comments")
.orderBy("timestamp","desc")
.onSnapshot(snapshot=>{
  const container = document.getElementById("commentList");
  container.innerHTML="";
  snapshot.forEach(doc=>{
    renderComment(doc, container);
  });
});

function renderComment(doc, container){
  const c = doc.data();
  const div = document.createElement("div");
  div.className="comment";

  div.innerHTML=`
    <b>${c.name}</b>: ${c.text}<br>
    <button onclick="vote('${doc.id}','likes')">üëç ${c.likes||0}</button>
    <button onclick="vote('${doc.id}','dislikes')">üëé ${c.dislikes||0}</button>
  `;

  container.appendChild(div);
}

function vote(id,field){
  const key = id+"_"+field;
  if(localStorage.getItem(key)) return;

  db.collection("comments").doc(id).update({
    [field]: firebase.firestore.FieldValue.increment(1)
  });

  localStorage.setItem(key,"yes");
}

// ===== –°–õ–ê–ô–î–ï–† =====
let index=0;
function moveSlide(step){
  const slides=document.getElementById("slides");
  const total=slides.children.length;
  const width=slides.children[0].offsetWidth+15;
  index+=step;
  if(index<0) index=total-1;
  if(index>=total) index=0;
  slides.style.transform="translateX(-"+index*width+"px)";
}

</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–•–æ—Ä–æ—à–∏–π, –ø–ª–æ—Ö–æ–π, –∑–ª–æ–π (1966)</title>

<style>
body{
  margin:0;
  font-family:'Arial Black',sans-serif;
  background:#1b0000;
  color:#eee;
  overflow-x:hidden;
}

.wrapper{
  width:70%;
  margin:0 auto;
  padding-bottom:60px;
}

/* –ü—ã–ª—å */
body::after{
  content:"";
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  pointer-events:none;
  z-index:999;
  background-image:
    radial-gradient(2px 2px at 20px 30px, rgba(255,220,180,0.4), transparent),
    radial-gradient(2px 2px at 100px 80px, rgba(255,220,180,0.4), transparent),
    radial-gradient(2px 2px at 200px 150px, rgba(255,220,180,0.4), transparent),
    radial-gradient(2px 2px at 300px 50px, rgba(255,220,180,0.4), transparent);
  background-repeat:repeat;
  background-size:400px 400px;
  animation:dust 20s linear infinite;
}
@keyframes dust{
  from{transform:translateY(0);}
  to{transform:translateY(-400px);}
}

/* –°–ª–∞–π–¥–µ—Ä */
.slider{
  position:relative;
  margin-top:20px;
  overflow:hidden;
  border-radius:10px;
  height:200px;
  background:#220000;
  padding:10px;
  box-shadow:0 0 15px #900;
}
.slides{display:flex;transition:0.5s;}
.slides img{
  width:300px;
  margin-right:15px;
  border-radius:5px;
  cursor:pointer;
  transition:0.3s;
}
.slides img:hover{transform:scale(1.05);}
.prev,.next{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  background:#330000;
  border:none;
  color:white;
  font-size:20px;
  padding:8px;
  cursor:pointer;
  border-radius:5px;
}
.prev{left:5px;}
.next{right:5px;}

/* –ò–Ω—Ñ–æ */
.top{
  display:flex;
  gap:30px;
  margin-top:30px;
}
.poster img{
  width:250px;
  border-radius:10px;
  box-shadow:0 0 20px #900;
}
.description{
  margin-top:30px;
  line-height:1.6;
  padding:15px;
  background:#220000;
  border-radius:10px;
  box-shadow:0 0 15px #900;
}

/* –í–∏–¥–µ–æ */
.video-container{
  margin-top:30px;
}
.video-container iframe{
  width:100%;
  height:500px;
  border-radius:10px;
  box-shadow:0 0 25px #900;
}

/* –ö–Ω–æ–ø–∫–∏ */
button{
  padding:6px 10px;
  background:#330000;
  color:white;
  border:1px solid #aa0000;
  border-radius:5px;
  cursor:pointer;
  margin-top:5px;
}
button:hover{background:#660000;}

/* –†–µ–π—Ç–∏–Ω–≥ */
.star{
  font-size:24px;
  color:#550000;
  cursor:pointer;
}
.star.selected{color:gold;}
#avgRating{
  font-size:18px;
  color:gold;
  margin-top:20px;
}

/* –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ */
.comment{
  background:#140000;
  padding:10px;
  margin-top:10px;
  border-left:4px solid #aa0000;
  border-radius:5px;
}
</style>
</head>

<body>
<div class="wrapper">

<h2>–•–æ—Ä–æ—à–∏–π, –ø–ª–æ—Ö–æ–π, –∑–ª–æ–π (1966)</h2>

<!-- –°–ª–∞–π–¥–µ—Ä -->
<div class="slider">
  <div class="slides" id="slides">
    <img src="https://upload.wikimedia.org/wikipedia/en/4/45/Good_the_bad_and_the_ugly_poster.jpg">
<img src="https://m.media-amazon.com/images/I/91z+4nW6zRL._AC_SL1500_.jpg">
<img src="https://upload.wikimedia.org/wikipedia/commons/2/22/The_Good_the_Bad_and_the_Ugly.jpg">

  </div>
  <button class="prev" onclick="moveSlide(-1)">‚ùÆ</button>
  <button class="next" onclick="moveSlide(1)">‚ùØ</button>
</div>

<!-- –ò–Ω—Ñ–æ -->
<div class="top">
  <div class="poster">
    <img src="https://i.imgur.com/XKxOxxg.jpg">
  </div>
  <div>
    <p><b>–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:</b> The Good, the Bad and the Ugly</p>
    <p><b>–°—Ç—Ä–∞–Ω—ã:</b> –ò—Ç–∞–ª–∏—è, –ò—Å–ø–∞–Ω–∏—è</p>
    <p><b>–ñ–∞–Ω—Ä:</b> –í–µ—Å—Ç–µ—Ä–Ω / –≠–∫—à–Ω</p>
    <p><b>–†–µ–π—Ç–∏–Ω–≥ –ö–∏–Ω–æ–ü–æ–∏—Å–∫:</b> 8.6</p>
    <p><b>–†–µ–π—Ç–∏–Ω–≥ IMDb:</b> 8.8</p>
    <p><b>–†–µ–∂–∏—Å—Å—ë—Ä:</b> –°–µ—Ä–¥–∂–æ –õ–µ–æ–Ω–µ</p>
    <p><b>–ê–∫—Ç—ë—Ä—ã:</b> –ö–ª–∏–Ω—Ç –ò—Å—Ç–≤—É–¥, –õ–∏ –í–∞–Ω –ö–ª–∏—Ñ, –ò–ª–∞–π –£–æ–ª–ª–∞–∫</p>
  </div>
</div>

<div class="description">
–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä—ë—Ö –æ—Ö–æ—Ç–Ω–∏–∫–æ–≤ –∑–∞ —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–∞ –ì—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–π –≤–æ–π–Ω—ã –≤ –°–®–ê.
</div>

<!-- –í–∏–¥–µ–æ -->
<div class="video-container">
  <iframe id="movie"
    src="https://www.youtube.com/embed/0Bwxz16-T04?enablejsapi=1"
    allowfullscreen></iframe>
</div>

<!-- –†–µ–π—Ç–∏–Ω–≥ -->
<div id="avgRating">–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥: ‚≠ê0.0</div>
<div>
  <span class="star" data-value="1">‚òÖ</span>
  <span class="star" data-value="2">‚òÖ</span>
  <span class="star" data-value="3">‚òÖ</span>
  <span class="star" data-value="4">‚òÖ</span>
  <span class="star" data-value="5">‚òÖ</span>
  <span id="votes">(0 –≥–æ–ª–æ—Å–æ–≤)</span>
</div>

<!-- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
<h3>–í—Ö–æ–¥</h3>
<input type="text" id="loginName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
<button onclick="login()">–í–æ–π—Ç–∏</button>
<p id="currentUser"></p>

  <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
<input type="text" id="commentInput" placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π">
<button id="sendComment">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
<div id="commentList"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSy....",
  authDomain: "project.firebaseapp.com",
  projectId: "project-id"
};


firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let currentUser = localStorage.getItem("currentUser") || null;

// –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
function login(){
  const name = document.getElementById("loginName").value.trim();
  if(!name) return;
  localStorage.setItem("currentUser", name);
  currentUser = name;
  document.getElementById("currentUser").innerText = "–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: " + name;
}

if(currentUser){
  document.getElementById("currentUser").innerText = "–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: " + currentUser;
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
document.getElementById("sendComment").addEventListener("click", async () => {
  if(!currentUser){
    alert("–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ!");
    return;
  }

  const text = document.getElementById("commentInput").value.trim();
  if(!text) return;

  await db.collection("comments").add({
    name: currentUser,
    text: text,
    likes: 0,
    dislikes: 0,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });

  document.getElementById("commentInput").value = "";
});

// –°–ª—É—à–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
db.collection("comments")
  .orderBy("timestamp", "desc")
  .onSnapshot(snapshot => {
    const container = document.getElementById("commentList");
    container.innerHTML = "";

    snapshot.forEach(doc => {
      const c = doc.data();
      const div = document.createElement("div");
      div.className = "comment";

      div.innerHTML = `
        <b>${c.name}</b>: ${c.text}<br>
        <button onclick="likeComment('${doc.id}')">üëç ${c.likes || 0}</button>
        <button onclick="dislikeComment('${doc.id}')">üëé ${c.dislikes || 0}</button>
      `;

      container.appendChild(div);
    });
  });

// –õ–∞–π–∫
async function likeComment(id){
  const ref = db.collection("comments").doc(id);
  await db.runTransaction(async (transaction) => {
    const doc = await transaction.get(ref);
    if(!doc.exists) return;
    transaction.update(ref, {
      likes: (doc.data().likes || 0) + 1
    });
  });
}

// –î–∏–∑–ª–∞–π–∫
async function dislikeComment(id){
  const ref = db.collection("comments").doc(id);
  await db.runTransaction(async (transaction) => {
    const doc = await transaction.get(ref);
    if(!doc.exists) return;
    transaction.update(ref, {
      dislikes: (doc.data().dislikes || 0) + 1
    });
  });
}
</script> 

  
// –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
function login(){
  let name = document.getElementById("loginName").value.trim();
  if(!name) return;
  localStorage.setItem("currentUser", name);
  currentUser = name;
  document.getElementById("currentUser").innerText = "–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: "+name;
}
if(currentUser){
  document.getElementById("currentUser").innerText = "–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: "+currentUser;
}

// –°–ª–∞–π–¥–µ—Ä
let index=0;
function moveSlide(step){
  let slides=document.getElementById("slides");
  let total=slides.children.length;
  let slideWidth=slides.children[0].offsetWidth + 15;
  index += step;
  if(index<0) index=total-1;
  if(index>=total) index=0;
  slides.style.transform="translateX(-"+index*slideWidth+"px)";
}

// –†–µ–π—Ç–∏–Ω–≥
let stars=document.querySelectorAll('.star');
function loadRating(){
  let totalVotes=parseInt(localStorage.getItem('totalVotes'))||0;
  let totalScore=parseInt(localStorage.getItem('totalScore'))||0;
  let avg=totalVotes?(totalScore/totalVotes).toFixed(1):"0.0";
  document.getElementById('votes').innerText=`(${totalVotes} –≥–æ–ª–æ—Å–æ–≤)`;
  document.getElementById('avgRating').innerText=`–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥: ‚≠ê${avg}`;
}
stars.forEach((star)=>{
  star.addEventListener('click',()=>{
    if(localStorage.getItem("voted")) return;
    let val=parseInt(star.getAttribute('data-value'));
    let totalVotes=parseInt(localStorage.getItem('totalVotes'))||0;
    let totalScore=parseInt(localStorage.getItem('totalScore'))||0;
    totalVotes++;
    totalScore+=val;
    localStorage.setItem('totalVotes',totalVotes);
    localStorage.setItem('totalScore',totalScore);
    localStorage.setItem('voted',true);
    loadRating();
  });
});
loadRating();

// Firebase –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
// HTML –±–ª–æ–∫
document.write(`
<h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
<input type="text" id="commentInput" placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π">
<button onclick="addComment()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
<div id="commentList"></div>
`);

db.collection("comments")
  .orderBy("likes","desc")
  .onSnapshot(snapshot=>{
    renderComments(snapshot.docs.map(doc=>({id:doc.id,...doc.data()})));
  });

function renderComments(comments){
  const container=document.getElementById("commentList");
  container.innerHTML="";
  comments.forEach(c=>{
    let score=c.likes-c.dislikes;
    let badge=score>=5?" üèÜ":"";
    let div=document.createElement("div");
    div.className="comment";
    div.innerHTML=`<b>${c.name}</b>${badge}: ${c.text}<br>
      <button onclick="like('${c.id}')">üëç ${c.likes}</button>
      <button onclick="dislike('${c.id}')">üëé ${c.dislikes}</button>`;
    container.appendChild(div);
  });
}

function addComment(){
  if(!currentUser){alert("–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ!"); return;}
  let text=document.getElementById("commentInput").value.trim();
  if(!text) return;
  db.collection("comments").add({
    name: currentUser,
    text: text,
    likes:0,
    dislikes:0
  });
  document.getElementById("commentInput").value="";
}

function like(id){
  let docRef=db.collection("comments").doc(id);
  db.runTransaction(async (transaction)=>{
    const doc=await transaction.get(docRef);
    if(!doc.exists) return;
    transaction.update(docRef,{likes:(doc.data().likes||0)+1});
  });
}

function dislike(id){
  let docRef=db.collection("comments").doc(id);
  db.runTransaction(async (transaction)=>{
    const doc=await transaction.get(docRef);
    if(!doc.exists) return;
    transaction.update(docRef,{dislikes:(doc.data().dislikes||0)+1});
  });
}
</script>
</div>
</body>
</html>
